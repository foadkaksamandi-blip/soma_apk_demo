# آفلاین بانک - دمو پرداخت آفلاین

این پروژه یک نسخه آزمایشی (دمو) از یک سیستم پرداخت بانکی آفلاین است که با استفاده از QR کد کار می‌کند. این سیستم شامل دو اپلیکیشن شبیه‌سازی شده است: یکی برای فروشنده (`seller-app`) و دیگری برای خریدار (`buyer-app`).

## هدف پروژه

هدف، نمایش یک راهکار عملی برای انجام تراکنش‌های مالی در شرایطی است که هیچ‌یک از طرفین (خریدار و فروشنده) به اینترنت دسترسی ندارند. امنیت تراکنش‌ها از طریق امضای دیجیتال تأمین می‌شود.

## جریان کاری (Workflow)

1.  **ایجاد درخواست پرداخت (فروشنده):**
    *   فروشنده مبلغ تراکنش را در اپلیکیشن خود وارد می‌کند.
    *   اسکریپت `seller-app/transaction_handler.py` یک ساختار داده JSON حاوی اطلاعات تراکنش (شناسه فروشنده، مبلغ، شناسه یکتای تراکنش) ایجاد می‌کند.
    *   این اطلاعات به یک QR کد تبدیل شده و روی صفحه نمایش داده می‌شود (در این دمو، در فایل `payment_qr.png` ذخیره می‌شود).

2.  **پردازش پرداخت (خریدار):**
    *   خریدار با استفاده از اپلیکیشن خود، QR کد تولید شده توسط فروشنده را اسکن می‌کند.
    *   اسکریپت `buyer-app/transaction_handler.py` اطلاعات QR کد را می‌خواند و به کاربر نمایش می‌دهد.
    *   پس از تأیید کاربر، اپلیکیشن خریدار یک "رسید دیجیتال" تولید می‌کند.

3.  **امضای دیجیتال و تأیید نهایی:**
    *   رسید دیجیتال با استفاده از **کلید خصوصی** خریدار (که به صورت امن در دستگاه او ذخیره شده) امضا می‌شود. این امضا تضمین می‌کند که پرداخت توسط صاحب حساب تأیید شده است.
    *   نتیجه نهایی (شامل رسید و امضای دیجیتال) به فروشنده نمایش داده می‌شود. فروشنده می‌تواند این اطلاعات را ذخیره کرده تا بعداً با بانک اعتبارسنجی کند.

## ساختار پروژه

```
.
├── buyer-app/
│   ├── main.py
│   └── transaction_handler.py
├── seller-app/
│   ├── main.py
│   └── transaction_handler.py
├── payment_qr.png
├── requirements.txt
└── README.md
```

-   `seller-app`: کدهای مربوط به اپلیکیشن فروشنده.
-   `buyer-app`: کدهای مربوط به اپلیکیشن خریدار.
-   `payment_qr.png`: نمونه QR کد تولید شده توسط فروشنده.
-   `requirements.txt`: لیست کتابخانه‌های پایتون مورد نیاز.

## نحوه اجرای دمو

1.  **نصب وابستگی‌ها:**
    ابتدا مطمئن شوید که `libzbar0` روی سیستم شما نصب است:
    ```bash
    sudo apt-get update && sudo apt-get install -y libzbar0
    ```
    سپس کتابخانه‌های پایتون را نصب کنید:
    ```bash
    pip install -r requirements.txt
    ```

2.  **اجرای اپلیکیشن فروشنده:**
    برای شبیه‌سازی ایجاد یک درخواست پرداخت به مبلغ ۵۰,۰۰۰ ریال، دستور زیر را اجرا کنید:
    ```bash
    python3 seller-app/transaction_handler.py
    ```
    این دستور یک فایل به نام `payment_qr.png` در ریشه پروژه ایجاد می‌کند.

3.  **اجرای اپلیکیشن خریدار:**
    برای شبیه‌سازی اسکن QR کد و پردازش پرداخت، دستور زیر را اجرا کنید:
    ```bash
    python3 buyer-app/transaction_handler.py
    ```
    این اسکریپت از شما می‌خواهد که پرداخت را تأیید کنید. با وارد کردن `yes`، یک رسید دیجیتال امضا شده در خروجی چاپ می‌شود.

## نکات فنی و امنیتی

-   **امضای دیجیتال:** استفاده از رمزنگاری نامتقارن (کلید عمومی/خصوصی) هسته اصلی امنیت این سیستم است. هر تراکنش توسط کلید خصوصی خریدار امضا می‌شود و می‌تواند بعداً توسط کلید عمومی او (که در اختیار بانک است) تأیید شود.
-   **شناسه یکتای تراکنش (`transaction_id`):** این شناسه از حملات بازپخش (Replay Attacks) جلوگیری می‌کند و تضمین می‌دهد که یک QR کد فقط برای یک تراکنش قابل استفاده است.
-   **مدیریت کلید:** در یک اپلیکیشن واقعی، کلیدهای خصوصی باید در امن‌ترین مکان ممکن (مانند Keystore در اندروید یا Keychain در iOS) ذخیره شوند.

## مراحل بعدی برای توسعه

-   **رابط کاربری (UI):** پیاده‌سازی یک رابط کاربری گرافیکی برای هر دو اپلیکیشن.
-   **ارتباط با سرور:** افزودن منطق همگام‌سازی (Synchronization) برای ارسال تراکنش‌های آفلاین به سرور بانک در زمان اتصال به اینترنت.
-   **اعتبارسنجی رسید:** پیاده‌سازی منطق سمت فروشنده برای تأیید امضای دیجیتال رسید دریافت شده از خریدار.
-   **استفاده از بلوتوث:** افزودن بلوتوث به عنوان یک روش ارتباطی جایگزین برای شرایطی که استفاده از دوربین ممکن نیست.
```
